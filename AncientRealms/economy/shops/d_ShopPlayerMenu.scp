[DIALOG d_ShopPlayerMenu]
1,1
PAGE 0
	RESIZEPIC 0 0 5120 590 210
	RESIZEPIC 280 20 9300 290 171
	GUMPPIC 20 15 9460
	DHTMLGUMP 48 60 200 110 0 0 <DEF.CENTER><SERV.UID.<LINK.UID>.REGION.NAME><DEF.CENTERE>
	IF <EVAL <SERV.UID.<LINK.UID>.TAG.ShopActivated>>=1
		DHTMLGUMP 48 140 200 110 0 0 <DEF.CENTER>Shop Is Open<DEF.CENTERE>
	ELSE
		DHTMLGUMP 48 140 200 110 0 0 <DEF.CENTER>Shop Is Closed<DEF.CENTERE>
	ENDIF
	IF <SERV.UID.<LINK.UID>.TAG.ShopActivated>
		DHTMLGUMP 48 100 200 110 0 0 <DEF.CENTER>Owner : <SERV.UID.<LINK.UID>.TAG.OwnersName><DEF.CENTERE>
		DHTMLGUMP 48 140 200 110 0 0 <DEF.CENTER>Shop Is Open<DEF.CENTERE>
	ELSE
		DHTMLGUMP 48 100 200 110 0 0 <DEF.CENTER><SERV.UID.<LINK.UID>.TAG.OwnersName><DEF.CENTERE>
		DHTMLGUMP 48 140 200 110 0 0 <DEF.CENTER>Shop Is Closed<DEF.CENTERE>
	ENDIF
	
PAGE 1
	IF (<SERV.UID.<LINK.UID>.TAG.OwnersUID>)
		IF (<SRC.UID>==<SERV.UID.<LINK.UID>.TAG.OwnersUID>)
			SRC.TAG.ShopRent<LINK.UID>=
			BUTTON 300 40 5601 5605 0 2 10
			DTEXT 320 38 342 OWNERS COMMANDS
			BUTTON 300 60 5601 5605 0 4 12
			DTEXT 320 58 342 CUSTOMERS MANAGEMENT
		ELSE
			BUTTON 300 40 5601 5605 0 1 20
			DTEXT 320 38 342 SHOP DETAILS
			DTEXT 320 61 955 Current Shop Owner <SERV.UID.<LINK.UID>.TAG.OwnersName>
			IF (<SERV.UID.<SERV.UID.<LINK.UID>.TAG.OwnersUID>.FINDID.i_LicencedMerchant.TIMER> < 1)
				DTEXT 320 81 955 Trading Licence of <SERV.UID.<LINK.UID>.TAG.OwnersName>:
				DTEXT 320 101 38 Expired!
				BUTTON 300 132 5601 5605 1 0 14
				DTEXT 320 130 342 EVICTION PERMITTED	
			ELSE
				DTEXT 320 81 955 Trading Licence of <SERV.UID.<LINK.UID>.TAG.OwnersName>:
				DTEXT 320 101 955 Expires: <SERV.UID.<SERV.UID.<LINK.UID>.TAG.OwnersUID>.FINDID.i_LicencedMerchant.TIMER> Seconds
			ENDIF
		ENDIF
	ELSE
		BUTTON 300 40 5601 5605 0 3 30
		DTEXT 320 38 342 RENT THIS SHOP
		BUTTON 300 60 5601 5605 1 0 22
		DTEXT 320 58 342 PLAYER INFORMATION
		//DTEXT 460 58 955 (Opens Webpage)
	ENDIF
	IF (<SRC.FINDID.i_LicencedMerchant>)
		DTEXT 300 160 63 <SRC.NAME> : Licensed Merchant
	ELSE
		DTEXT 300 160 00029 <SRC.NAME> : Unlicensed Merchant
	ENDIF

PAGE 2
	button 300 83 2117 2118 1 0 210
	dtext 320 80 955 Lock an item down.
	button 300 103 2117 2118 1 0 220
	dtext 320 100 955 Release an item.
	IF <SERV.UID.<LINK.UID>.TAG.ShopActivated>
		button 300 123 2117 2118 1 0 230
		dtext 320 120 955 Close the Shop.
	ELSE
		button 300 123 2117 2118 1 0 240
		dtext 320 120 955 Open the Shop.
	ENDIF
	IF (<SERV.UID.<LINK.UID>.TAG0.VendorCount>)
		DTEXT 300 160 63 Vendors Placed : (<EVAL <SERV.UID.<LINK.UID>.TAG.VendorCount>>/4)
	ELSE
		DTEXT 300 160 00029 <SRC.NAME> : Currently No Vendors Placed
	ENDIF

PAGE 3
	BUTTON 300 40 5601 5605 0 3 30
	DTEXT 320 38 342 RENT THIS SHOP
	DTEXT 300 70 55 Deposit : 
	TILEPIC 350 68 0eef
	IF (<SRC.TAG0.ShopDeposit<LINK.UID>>)
		DTEXT 390 70 63 Paid by <SRC.NAME>
		BUTTON 490 72 038 037 1 0 45
		DTEXT 510 70 55 Withdraw
	ELSE
		DTEXT 390 70 55 <EVAL ShopsTownShopDeposit>gp
		BUTTON 490 72 037 037 1 0 40
		DTEXT 510 70 55 Pay
	ENDIF
	DTEXT 300 100 55 Rent : 
	TILEPIC 350 98 0eef
	IF (<SRC.TAG0.ShopRent<LINK.UID>>)
		DTEXT 390 100 63 Paid by <SRC.NAME>
		BUTTON 490 102 038 037 1 0 55
		DTEXT 510 100 55 Withdraw
	ELSE
		DTEXT 390 100 55 <EVAL ShopsTownShopRent>gp
		BUTTON 490 102 037 037 1 0 50
		DTEXT 510 100 55 Pay
	ENDIF
	DTEXT 300 130 55 Licence : 
	TILEPIC 350 128 0c09
	IF (<SRC.FINDID.i_LicencedMerchant>)
		DTEXT 390 130 55 Expires : <EVAL <SRC.FINDID.i_LicencedMerchant.TIMER>> Seconds
	ELSE
		DTEXT 390 130 55 Traders Licence Needed
	ENDIF
	DTEXT 320 160 342 BACK
	BUTTON 300 162 5603 5605 0 1 10

PAGE 4
	BUTTON 300 83 2117 2118 1 0 90
	DTEXT 320 80 955 Bann a Player.
	BUTTON 300 103 2117 2118 1 0 100
	DTEXT 320 100 955 Unbann a Player.

[Dialog d_ShopPlayerMenu BUTTON]
ONBUTTON=14
	IF <SRC.FINDID.i_LicencedMerchant>
		EVICTPLAYER <SERV.UID.<SERV.UID.<LINK.UID>.TAG.OwnersUID>>, <SERV.UID.<LINK.UID>.REGION.UID>, <LINK.UID>
		SERV.UID.<LINK.UID>.TAG.ShopActivated=0
	ELSE
		SRC.SYSMESSAGE @color_ore_Autonite Only a licenced trader may serve an eviction notice on a shop! You are not licenced, you can buy a trading licence from the inn keeper or a scribe.
	ENDIF
	RETURN 1
	
ONBUTTON=22
	SRC.SYSMESSAGE @95 Traders Information
	SRC.WEBLINK=ancientl2.dyndns.biz/players.html
	
ONBUTTON=40
IF (<SRC.FINDID.i_LicencedMerchant>)
	IF (<SRC.RESTEST <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG0.TownShopDeposit>> i_gold>)
		SRC.CONSUME <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG0.TownShopDeposit>> i_gold	
		SRC.TAG.ShopDeposit<LINK.UID>=1
		SFX 740
	ELSE
		SRC.SYSMESSAGE @0029 You need <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG0.TownShopDeposit>> gold.
		SRC.TAG.ShopDeposit<LINK.UID>=
	ENDIF
	CALL SRC.f_SetupShopKeeper <LINK.UID>
	DIALOG d_ShopPlayerMenu
ELSE
	SRC.SYSMESSAGE @0029 You need a valid Trading Licence!
	SRC.TAG.ShopDeposit<LINK.UID>=
ENDIF

ONBUTTON=45
	IF <SRC.TAG.ShopDeposit<LINK.UID>>
		NEWITEM i_gold, <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopDeposit>>, <SRC.UID>
		SRC.SYSMESSAGE @63 <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopDeposit>> gold returned.
		SRC.TAG.ShopDeposit<LINK.UID>=
		SFX 53
	ELSE
		SRC.SYSMESSAGE @0029 You have not Paid a Deposit here.
		SRC.TAG.ShopDeposit<LINK.UID>=
	ENDIF
	CALL SRC.f_SetupShopKeeper <LINK.UID>
	DIALOG d_ShopPlayerMenu

ONBUTTON=50
	IF (<SRC.FINDID.i_LicencedMerchant>)
		IF (<SRC.RESTEST <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopRent>> i_gold>)
			SRC.CONSUME <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopRent>> i_gold	
			SRC.TAG.ShopRent<LINK.UID>=1
			SFX 740
		ELSE
			SRC.SYSMESSAGE @0029 You need <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopRent>> gold.
			SRC.TAG.ShopRent<LINK.UID>=
		ENDIF
		CALL SRC.f_SetupShopKeeper <LINK.UID>
		DIALOG d_ShopPlayerMenu
	ELSE
		SRC.SYSMESSAGE @0029 You need a valid Trading Licence!
		SRC.TAG.ShopRent<LINK.UID>=
	ENDIF

ONBUTTON=55
	IF <SRC.TAG.ShopRent<LINK.UID>>
		NEWITEM i_gold, <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopRent>>, <SRC.UID>
		SRC.SYSMESSAGE @63 <EVAL <SERV.UID.<REGION.TAG.TownTaxStoneUid>.TAG.TownShopRent>> gold returned.
		SRC.TAG.ShopRent<LINK.UID>=
		SFX 53
	ELSE
		SRC.SYSMESSAGE @0029 You have not Paid any Rent here.
		SRC.TAG.ShopRent<LINK.UID>=
	ENDIF
	CALL SRC.f_SetupShopKeeper <LINK.UID>
	DIALOG d_ShopPlayerMenu

//Page 2
ONBUTTON=210 //Lock Down an Item
	IF (<SERV.UID.<LINK.UID>.REGION.UID>==<SRC.REGION.UID>)
		IF (<SERV.UID.<LINK.UID>.TAG.OwnersUID>==<SRC.UID>)
			SRC.SYSMESSAGE @95 Select an Item To LockDown
			TARGETF LockDownItem
		ENDIF
	ENDIF
	
ONBUTTON=220 //Release an Item
	IF (<SERV.UID.<LINK.UID>.REGION.UID>==<SRC.REGION.UID>)
		IF (<SERV.UID.<LINK.UID>.TAG.OwnersUID>==<SRC.UID>)
			SRC.SYSMESSAGE @95 Select an Item To Release
			TARGETF ReleaseItem
		ENDIF
	ENDIF
	
ONBUTTON=230 //Close Shop
	SERV.UID.<LINK.UID>.TAG.ShopActivated=0
ONBUTTON=240 //Open Shop
	SERV.UID.<LINK.UID>.TAG.ShopActivated=1
ONBUTTON=250 //Place a Vendor
	IF (<SERV.UID.<LINK.UID>.REGION.UID>==<SRC.REGION.UID>)
		IF (<SERV.UID.<LINK.UID>.TAG.OwnersUID>==<SRC.UID>)		
			IF (<SERV.UID.<LINK.UID>.TAG.VendorCount> < 4)
				SRC.SYSMESSAGE @95 Target your Vendor Deed
				TARGETF ValidateVendorDeed
			ELSE
				SRC.SYSMESSAGE @0029 This Shop Already Has 4 Vendors
			ENDIF				
		ENDIF
	ENDIF
	
[FUNCTION EVICTPLAYER]
// EVICTPLAYER <SERV.UID.<SERV.UID.<LINK.UID>.TAG.OwnersUID>> <SERV.UID.<LINK.UID>.REGION.UID>
// ARGV[0]	== Owners Uid
// ARGV[1]	== Shop Region Uid
// ARGV[2]  == Shop Clock Uid
SERV.B @63 <SERV.UID.<LINK.UID>.TAG.OwnersName> Has been evicted from <REGION.NAME> for trading without a licence.
LOCAL.ShopOwnersUID=<ARGV[0]>
LOCAL.ShopRegionUID=<ARGV[1]>
LOCAL.ShopClockUID=<ARGV[2]>

FOR X 1 <SERV.UID.<ARGV[2]>.TAG.VendorCount>
	LOCAL.VendorsUID=<SERV.UID.<ARGV[2]>.TAG.VendorCount<LOCAL.X>>
	IF <SERV.UID.<LOCAL.VendorsUID>.TAG0.OwnerUID> == <ARGV[0]>
		IF (<SERV.UID.<LOCAL.VendorsUID>.FINDID.i_vendor_use.LINK> == <ARGV[0]>)
			SERV.UID.<ARGV[0]>.TAG.VendorUse=<LOCAL.VendorsUID>
			SERV.UID.<ARGV[0]>.TAG.VendorMoney=<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.29.MORE>
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.29.MORE> > 0)
				SERV.NEWITEM i_gold, <SERV.UID.<ARGV[0]>.TAG.VendorMoney>, <SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.26.loopitems CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.27.loopitems cont=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.28.loopitems cont=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.1.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.1.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.2.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.2.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.3.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.3.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.4.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.4.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.5.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.5.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.6.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.6.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.7.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.7.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.8.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.8.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.10.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.10.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.12.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.12.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.13.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.13.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.14.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.14.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.18.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.18.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.20.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.20.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.22.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.22.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.23.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.23.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			IF (<SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.24.UID>!=0)
				TRY SERV.UID.<LOCAL.VendorsUID>.FINDLAYER.24.CONT=<SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			ENDIF
			SERV.NEWITEM i_VendorDeed, 1, <SERV.UID.<ARGV[0]>.FINDLAYER.29.UID>
			SERV.UID.<LOCAL.VendorsUID>.remove
			SERV.UID.<ARGV[0]>.TAG.vendormoney=
			SERV.UID.<ARGV[0]>.TAG.vendoruse=
			SERV.UID.<ARGV[0]>.TAG.getmoney=			
			SERV.UID.<ARGV[2]>.TAG.VendorCount<LOCAL.X>=			
		ENDIF
	ENDIF
ENDFOR
SERV.UID.<ARGV[0]>.SYSMESSAGE @0029 You have been Evicted from a Shop. Your Vendors and Items are all in your Bank.Remeber to Renew your Trading License to Avoid this Happening.
SERV.UID.<ARGV[0]>.TAG.ShopDeposit<LINK.UID>=
SERV.UID.<ARGV[0]>.TAG.ShopRent<LINK.UID>=
SERV.UID.<ARGV[2]>.ResetShopClock

[DIALOG d_shopinfo]
1,1
PAGE 0
RESIZEPIC 0 0 2620 360 380
DTEXT 40 30 55 Players Shop Information
DTEXT 40 50 55 Players Shop Information
DTEXT 40 70 55 Players Shop Information
DTEXT 40 90 55 CREYON :P

[EOF]
